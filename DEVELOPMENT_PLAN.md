# 「GWS Automater for Android」実装計画

## 現在の開発状況 (2025-11-11)
- **課題:**
    - Firebase Authentication / Firestore連携部分でgRPC関連の `java.lang.NoClassDefFoundError` が発生し、サインイン処理後にアプリがクラッシュする。
    - 依存関係の調整（`grpc-core`の追加、gRPC関連ライブラリの削除とFirebase BOMへの一本化）を試みたが、問題は解決していない。

- **現在の方針:**
    - クラッシュ問題を一時的に回避するため、`SettingsFragment`内のサインイン処理をコメントアウト済み。
    - 認証機能を一時的に切り離し、ログインが不要な範囲のUI実装と機能開発を優先して進める。

---

## 開発計画

### フェーズ1: アプリケーション基盤とユーザー認証

**目標:** アプリケーションの基本的な骨格を構築し、ユーザー認証を実装し、データベースの構造をセットアップする。

- [x] **Task:** 3つのタブ（ワークフロー、トリガー、設定）を持つボトムナビゲーションバーを実装する。
- [x] **Task:** Firebase Authenticationを使用し、Googleサインインによるユーザー認証を実装する。 **(現在ブロック中)**
- [x] **Task:** 認証状態を管理し、ユーザーをリダイレクトするためのスプラッシュスクリーンを作成する。
- [x] **(frontend)** **Task:** メイン画面用の基本的なアプリ内ナビゲーションを`NavHost`でセットアップする。
- [x] **Task:** ユーザープロファイルと設定情報を保存するための、Firestoreの基本データベース構造を定義する。
- [x] **Task:** 「サインアウト」ボタンを含む、基本的な「設定」画面のUIを実装する。
- [x] **Task:** アプリケーションの基本的なMaterial 3テーマ（色、タイポグラフィ）をセットアップする。
- [x] **Task:** 起動時の強制ログインを廃止し、アプリ内部（設定画面）から任意にログイン/ログアウトできるように再配置する。

---

### フェーズ2: コア・ワークフローエンジンとUI基盤

**目標:** ワークフローのデータモデルを定義し、一連のアクションを実行するコアエンジンを実装する。同時に、「ゲームのようなUI/UX」の核心部分の基盤を構築する。

- [ ] **Task:** `Workflow`、`Module`、`Trigger`のデータモデルをKotlinのdata classとして定義する。 **(現状: `Workflow`, `Module` のみ実装済み。`Trigger` が未実装)**
- [x] **Task:** モジュールのリストを順次実行できる、コア・ワークフロー実行エンジンを実装する。
- [x] **Task:** エンジンテスト用のシンプルな「ダミー」モジュールを2つ作成する（例：「トースト表示」モジュール、「ログ出力」モジュール）。
- [ ] **Task:** `Workflows`と`Triggers`を保存するためのFirestoreデータベース構造を定義する。 **(現状: `Workflows` のみ実装済み。`Triggers` が未実装)**
- [x] **Task:** Firestoreからワークフローデータを保存・取得するための`WorkflowRepository`クラスを作成する。 **(補足: `Workflow` の保存・取得は実装済み。`Trigger` 関連は未実装)**
- [ ] **Task (UI):** ワークフロー構築エディターの基盤として、直感的なドラッグ＆ドロップインターフェースを実装する。
- [ ] **Task (UI):** 実行状況の視覚化（初期版）：ワークフロー実行時に、モジュール間をデータが流れる様子をシンプルなアニメーションで表現する。
- [ ] **Task (UI):** モジュール選択GUIの基盤として、「本棚」形式のカテゴリ表示UIを実装する。

---

### フェーズ3: ワークフロー作成UIとGWS連携

**目標:** ユーザーがワークフローを作成・管理するUIを構築し、実用的なGWSモジュールの第一弾を開発する。

- [x] **Task:** Firestoreからユーザーの保存済みワークフローの一覧を取得し、「ワークフロー」メイン画面に表示する。
- [x] **Task:** ワークフロー画面に「新規ワークフロー作成」ボタン（例: FAB）を設置する。
- [x] **(frontend)** **Task:** ユーザーがリストからモジュールを追加できる、ワークフローエディタ画面のUIを設計する。
- [x] **(frontend)** **Task:** ワークフローエディタ内で、モジュールの並べ替えと削除を可能にする。
- [x] **Task:** エディタで構築されたワークフローをFirestoreに保存するロジックを実装する。
- [ ] **Task (GWS):** Google APIクライアントをセットアップし、GWSアクセスに必要なOAuth2トークンスコープを処理する。
- [ ] **Task (GWS):** **Gmail**モジュール（受信トリガー、メール送信、添付ファイル保存）を開発する。
- [ ] **Task (GWS):** **Google Drive**モジュール（ファイルアップロード/ダウンロード、フォルダ作成）を開発する。
- [ ] **Task (GWS):** **Google Sheets**モジュール（行追加、セル更新、データ取得）を開発する。
- [ ] **Task (GWS):** **Google Calendar**モジュール（イベント作成、取得）を開発する。
- [ ] **Task (ユーティリティ):** **条件分岐 (If/Else)** と **待機 (Delay)** モジュールを開発する。

---

### フェーズ4: トリガーとスケジューリング

**目標:** スケジュールに基づいてワークフローを自動実行する機能を実装する。

- [x] **Task:** 予約実行（トリガー）の追加ボタン（FAB）をスケジュール画面に設置する。
- [x] **Task:** 予約実行の設定画面をComposeで作成し、ナビゲーションを実装する。
- [x] **Task:** 予約実行の設定画面で、各種設定項目（時間毎、日毎、週毎、月毎）の具体的なUIを実装する。
- [ ] **Task:** `WorkManager`を使用して、信頼性の高いバックグラウンド実行のためのスケジューリングロジックを実装する。
- [ ] **Task:** スケジュールされたトリガーの一覧をカレンダー上に表示する。
- [ ] **Task:** スケジュールされた時間に、対応するワークフローを呼び出すトリガーハンドラを開発する。

---

### フェーズ5: 機能拡張と「ゲーム性」の深化

**目標:** GWS以外の連携を拡大し、「ゲームのような体験」を強化する。

- [ ] **Task:** **外部サービス連携**モジュール（Slack/Discord/Teams, Trello/Asanaなど）の開発に着手する。
- [ ] **Task:** ワークフローエディターに**ズームイン/アウト機能**や、よりリッチな稼働アニメーションを追加する。
- [ ] **Task:** モジュール選択GUIに**コレクション要素**（未入手モジュールのシルエット表示など）を本格実装する。
- [ ] **Task:** **アプリ内課金**によるモジュールパックやテーマパックの販売システムを実装する。
- [ ] **Task:** **繰り返し (Loop/For Each)** や **データ操作** などの高度なユーティリティモジュールを追加する。
- [ ] **Task:** チュートリアルをクエスト形式にしたり、実績・バッジシステムを導入する。

---

### フェーズ6: さらなる進化とコミュニティ形成

**目標:** 高度なパーソナライゼーションと共有機能を提供し、アプリのエコシステムを活性化させる。

- [ ] **Task:** 自然言語でワークフローのヒントを提供する **AIアシスタント機能** を補助的に実装する。
- [ ] **Task:** ユーザーが作成したワークフローテンプレートを共有・公開できる **テンプレートストア** を実装する。
- [ ] **Task:** ユーザーがテーマやモジュールの一部をカスタマイズできる機能を追加する。

---

### UI/UXデザインと開発環境

- **UI/UXの重点事項:**
    - [ ] アニメーションとサウンドによる心地よいフィードバック
    - [ ] 直感的なアイコンとビジュアル表現
    - [ ] スマートフォンでのタッチ操作の最適化
    - [ ] 年齢層に応じたUI調整 (Kids Mode)
- **開発環境:**
    - [x] **Task:** `Timber`を導入し、Logcatへのログ出力基盤を構築する。
    - [x] **Task:** `FileLoggingTree`を実装し、Logcatと同時に`debug.log`ファイルへログを書き出す仕組みを構築する。
    - [ ] **Task:** アプリ内の主要な処理に、`Timber`によるデバッグログを適切に配置する。

---

### 技術スタック
- **Android Native:** Kotlin, Jetpack Compose
- **Firebase:** Authentication, Crashlytics, Firestore
- **Google APIs Client Libraries:** Gmail, Drive, Sheets, Calendar
- **Dependency Injection:** Hilt

---

### 実機デバッグからのフィードバック (2025-11-12)

#### 全般的な改善
- [ ] **Task (UI):** アプリケーション全体のハイライトカラーを統一し、設定画面から変更できるようにする。
- [ ] **Task (UX):** 初回起動時に国、言語、週の開始曜日、テーマを設定するウィザードを実装する。
- [ ] **Task (UI):** ダッシュボードのアイコンをより適切なものに変更する。

#### ワークフロー画面
- [ ] **Task (UI):** 「新規ワークフロー作成」ボタンを、ワークフロー一覧の最下部に配置する。
- [ ] **Task (UI):** ドラッグ＆ドロップによるワークフロー構築画面を実装する（テーマ変更対応）。
- [ ] **Task (Dev):** テスト用のユーティリティモジュールを作成する。

#### スケジュール画面
- [ ] **Bug:** スケジュール追加画面でテーマが適用されない不具合を修正する。
- [ ] **Bug:** カレンダーの縦スクロール時の引っかかりを解消する。
- [ ] **Task (UI):** カレンダーの日付表示をボックス型にし、スケジュール概要を表示できるようにする。
- [ ] **Task (Dev):** スケジュール画面にテスト用データを表示する。

#### 履歴画面
- [ ] **Task:** 履歴画面を実装し、テスト用データを表示する。

#### ダッシュボード画面
- [ ] **Task:** ダッシュボード画面を実装し、テスト用データを表示する。

#### 設定（「︙」メニュー）
- [ ] **Bug:** お知らせ画面へのリンク切れを修正する。
- [ ] **Task (UI):** メニュー項目「アプリ設定」を「アプリケーションの設定」に文言変更する。
- [ ] **Task (UI):** ユーザー情報とアカウント連携の項目を「アプリケーションの設定」画面に統合する。
- [ ] **Task:** 「アプリケーションの設定」内に「タグ管理」機能を追加する（追加・編集・削除画面）。
- [ ] **Task:** 「このアプリについて」画面を実装し、以下の項目へのリンクを設置する。
    - [ ] 操作マニュアルページ
    - [ ] アプリケーションのレーティング
    - [ ] アプリケーションの共有
    - [ ] プライバシーポリシーページ
    - [ ] サードパーティライセンスページ
    - [ ] 制作者への問い合わせ
    - [ ] アプリケーションバージョン表示
